# 1.搜索歌曲,获取歌曲id# 'https://www.xiami.com/search?key='+ keyword+"&pos=1"# 2.xml页面，可查看网页代码，下载xml文件，并将文件拖入到指定的窗口获得文件路径# 'https://www.xiami.com/widget/xml-single/uid/0/sid/1804846198'+id# 3.获取location# 4.下载音乐# 5. java读取文件夹# 网页播放页面# 'https://www.xiami.com/play?ids=/song/playlist/id/'+id+'/object_name/default/object_id/0#loaded'# 歌曲详细信息页面# https://www.xiami.com/song/1796063337# 实现xml文件下载import mathimport os, time, requests, refrom random import choiceimport sysimport urllib.parsefrom bs4 import BeautifulSoupimport chardet  # 需要导入这个模块，检测编码格式import Configureclass Mp3Spider:    cookiestr = '''    gid=154069429053164; _unsign_token=198a3e1ea1212eb0462f96c381788ff1; UM_distinctid=166b8892fee3b0-066f1bd616e5db-b79183d-144000-166b8892ff0903; cna=LTMAFJG0Pn8CAXxYx4Z9Ob5h; xmgid=a6b2a37a-fa69-48ee-8ff7-cdb3183cc3aa; CNZZDATA921634=cnzz_eid%3D399771454-1540692380-https%253A%252F%252Fwww.baidu.com%252F%26ntime%3D1541416808; CNZZDATA2629111=cnzz_eid%3D1909180909-1540692295-https%253A%252F%252Fwww.baidu.com%252F%26ntime%3D1541419635; _xiamitoken=7683fa2b2afffc0217b3bc83e875a041; _uab_collina=154475732086593181952285; user=407159899%22Comi%22images%2Fuser%2F407159899%2F36bd90bc30cb4a62bdaf048425d4edfb_8ad8f326c321474faba5b8bfab110d10.jpg%220%22260%22%3Ca+href%3D%27http%3A%2F%2Fwww.xiami.com%2Fwebsitehelp%23help9_3%27+%3ELv4%3C%2Fa%3E%222%220%22903%22d510e68af7%221544951529; xm_token=f8eb7626eda9a42d48c6e9d1073b777d; uidXM=407159899; member_auth=12rIT4YY6Gxn2%2FLsB%2FV0LSNh4ozVSUOZgu0P8%2B5sw19BcPNWa%2FGokZHSC31Tr1XUrDhEGYSY3TxPGudVItCZuvbWRg; xm_sg_tk=16581cae49472f374700c94276040462_1545458866737; xm_sg_tk.sig=9rN_H_4C8N4QTqoOTi8AwCr_ZuD_Bn6i6pPbDPHtnZ4; _xm_umtoken=HV02PAAZ0b0aeb35767159475c1ddb55012387da100024; isg=BBcXOV4BB3NuPIQ3eGBzzrrApothXOu-zdWKpWlEvOZNmDbacCxQD9r-_nAjcMM2    '''    header = {'user-agent': choice(Configure.FakeUserAgents)}    localUrl = os.path.realpath(__file__)[:-7]    songs_name = []    location = []    SongUrls = {}    def __init__(self):        # print("获取当前文件路径——" + os.path.realpath(__file__))  # 获取当前文件路径        # 美国iTunes榜        # url = 'https://www.xiami.com/billboard/328'        url = "https://www.xiami.com/billboard/325"        r = requests.get(url, headers=self.header)        html = r.content        soup = BeautifulSoup(html, "html.parser")        # <div class="song-name em"><a href="/song/1802902669">Youngblood</a></div>        i = 0        for div in soup.find_all('div', {'class': 'song-name em'}):            for a in div.find_all('a'):                # print(a.text+" "+a.get('href')[6:])                if i <= 15:                    self.SingerId = a.get('href')[6:]                    self.GetLocation()                else:                    break                i += 1                # print(i)    def GetLocation(self):        url = "https://www.xiami.com/widget/xml-single/uid/0/sid/" + self.SingerId        r = requests.get(url, headers=self.header)        xml = r.content        encode_type = chardet.detect(xml)        xml = xml.decode(encode_type['encoding'])        # <location><![CDATA[(.*?)]]></location>        url = re.compile(r'<location><!\[CDATA\[(.*?)\]\]></location>', re.S)        song_name = re.compile(r'<song_name><!\[CDATA\[(.*?)\]\]></song_name>', re.S)        songs_name = re.findall(song_name, xml)        location = re.findall(url, xml)        for i in range(len(songs_name)):            if songs_name != []:                if songs_name[i] != self.SongUrls.get("song_name"):                    self.SongUrls['song_name'] = songs_name[i]                    self.SongUrls['Url'] = self.Decode(location[i])        if flag == 1:            print(self.SongUrls)        elif flag ==2:            self.DownloadSong()    def Decode(self, location):        _local10 = ""        _local2 = location[0:1]        _local3 = location[1:]        _local4 = math.floor(len(_local3) / int(_local2))        _local5 = int(len(_local3) % int(_local2))        # _local6 = str(_local2)        _local7 = 0        Url = []        while (_local7 < _local5):            # try:            #     if (Url[_local7] == None):            #         Url[_local7] = ""            # except:            #    e = ""            Url.append(_local3[((int(_local4) + 1) * _local7):                               ((int(_local4) + 1) * _local7) + (int(_local4) + 1)])            _local7 += 1        _local7 = _local5        _local2 = int(_local2)        while (_local7 < _local2):            Url.append(_local3[((int(_local4) * (_local7 - _local5)) + ((int(_local4) + 1) * _local5)):                               ((int(_local4) * (_local7 - _local5)) + ((int(_local4) + 1) * _local5)) + int(                                   _local4)])            _local7 += 1        _local8 = ""        _local7 = 0        while (_local7 < (len((str)(Url[0])))):            _local10 = 0            while (_local10 < len(Url)):                if (_local7 >= len(Url[_local10])):                    break                part = list(Url[_local10])                _local8 = (_local8 + part[_local7])                _local10 += 1            _local7 += 1        _local8 = urllib.parse.unquote(_local8)        _local9 = ""        _local7 = 0        while (_local7 < len(_local8)):            part = list(_local8)            if (_local8[_local7] == '^'):                _local9 = (_local9 + "0")            else:                _local9 = (_local9 + part[_local7])            _local7 += 1        _local9 = _local9.replace("+", " ")        return _local9    def DownloadSong(self):        if not os.path.exists("Download"):            os.makedirs("Download")        for songurl in self.SongUrls:            r = requests.get(self.SongUrls.get("Url"))            filename = "{0:s}.mp3".format(self.SongUrls.get("song_name"))            with open("Download/" + filename, 'wb') as file:                file.write(r.content)            print("Download {0:s} Successfully.".format(self.SongUrls.get("song_name")))if __name__ == '__main__':    a = []    for i in range(1, len(sys.argv)):        a.append(sys.argv[i])    flag = int(a[0])    print(flag)    Mp3Spider(flag)